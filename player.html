<!DOCTYPE html>
<html lang="en">
<head>
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>

  <script type="text/javascript" src="http://cdn-files.deezer.com/js/min/dz.js"></script>

</head>
<body>
<div id="dz-root"></div>
<div id="player" style="width:100%;" align="center"></div>
<br/>

<script>

  var pageLoaded = false;

  function reload(opts){

    // First call is to be ignored
    if (!pageLoaded){
      pageLoaded = true;
      return;
    }

    DZ.player.pause(); // Necessary?
    window.location.href = window.location.href; // Trick for no warning


    // // Ignore first call, will be triggered on page load
    // if( !pageLoaded ){
    //   pageLoaded = true;
    //   var currentTrackId = parseInt(opts.track.id);
    //   console.log('current track : ', opts.track);
    //   return false;
    // }

    // $.getJSON('/api/pop', function(newTrackId){
    //   DZ.api('/playlist/728065965/tracks', 'POST', { songs: [newTrackId] }, function(response){

    //     // Now, clear the former track and reload the page
    //     DZ.api('/playlist/728065965/tracks', 'DELETE', { songs: [currentTrackId] }, function(response){
    //       setTimeout(function(){
    //       }, 1000);
    //     });

    //   });
    // });
  }

  function onPlayerLoaded() {
    DZ.Event.subscribe('current_track', function(arg){
      reload(arg);
    });

    $.getJSON('/api/pop', function(trackId){
      DZ.player.playTracks([trackId]);
    });
  }

  DZ.init({
    appId  : '129845',
    channelUrl : 'http://bergerebeats.herokuapp.com/channel',
    player : {
      container : 'player',
      cover : true,
      width : 650,
      height : 300,
      onload : onPlayerLoaded
    }
  });

  DZ.login(function(response) {
    if (response.authResponse) {
      console.log('Welcome!  Fetching your information.... ');
      DZ.api('/user/me', function(response) {
        console.log('Good to see you, ' + response.name + '.');
      });
    } else {
      console.log('User cancelled login or did not fully authorize.');
    }
  }, {perms: 'manage_library,delete_library'});


</script><br/>
event_listener : <br/>
<pre id="event_listener" style="height:100px;overflow:auto;"></pre>
</body>
</html>